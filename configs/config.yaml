# HiveMemory ä¸»é…ç½®æ–‡ä»¶
#
# é…ç½®åˆ†å±‚åŸåˆ™:
# 1. ç¯å¢ƒå˜é‡ (.env): ä»…ç”¨äºæ•æ„Ÿä¿¡æ¯ (API Keys)ã€åŸºç¡€è®¾æ–½åœ°å€ (Host/Port) å’Œç¯å¢ƒåˆ‡æ¢ (Debug/Model)ã€‚
# 2. æ­¤æ–‡ä»¶ (config.yaml): ç”¨äºå®šä¹‰æ‰€æœ‰ä¸šåŠ¡é€»è¾‘å‚æ•°ã€ç®—æ³•é˜ˆå€¼ã€é»˜è®¤é…ç½®ç­‰ã€‚
#
# ç¯å¢ƒå˜é‡è¦†ç›–æœºåˆ¶:
# å°½ç®¡å»ºè®®éµå¾ªä¸Šè¿°åˆ†å±‚ï¼Œä½†æ‰€æœ‰é…ç½®é¡¹æŠ€æœ¯ä¸Šéƒ½æ”¯æŒé€šè¿‡ç¯å¢ƒå˜é‡è¦†ç›–ã€‚
# æ ¼å¼: HIVEMEMORY__<SECTION>__<FIELD> (åŒä¸‹åˆ’çº¿åˆ†éš”)
# ç¤ºä¾‹: HIVEMEMORY__PERCEPTION__SEMANTIC_FLOW__IDLE_TIMEOUT_SECONDS=900

# ========== ç³»ç»Ÿé…ç½® ==========
system:
  name: "HiveMemory"
  version: "0.1.0"
  debug: true

# ========== æ—¥å¿—é…ç½® ==========
logging:
  level: "INFO"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file_path: null  # è®¾ç½®ä¸ºè·¯å¾„ä»¥å¯ç”¨æ–‡ä»¶æ—¥å¿—
  console_output: true

# ========== LLM æ¨¡å‹é…ç½® ==========
llm:
  gateway:
    provider: "litellm"
    model: "gpt-4o"
    api_key: null  # é€šè¿‡ç¯å¢ƒå˜é‡ HIVEMEMORY__LLM__WORKER__API_KEY è®¾ç½®
    api_base: null
    temperature: 0.7
    max_tokens: 4096

  librarian:
    provider: "litellm"
    model: "deepseek/deepseek-chat"
    api_key: null  # é€šè¿‡ç¯å¢ƒå˜é‡ HIVEMEMORY__LLM__LIBRARIAN__API_KEY è®¾ç½®
    api_base: null
    temperature: 0.3
    max_tokens: 4096

# ========== Embedding æ¨¡å‹é…ç½® ==========
embedding:
  default:
    model_name: "BAAI/bge-m3"
    device: "cpu"  # å¯é€‰: cpu, cuda, mps
    cache_dir: null
    batch_size: 32
    normalize_embeddings: true
    dimension: 1024

  perception:
    model_name: "sentence-transformers/all-MiniLM-L6-v2"
    device: "cpu"
    cache_dir: null
    batch_size: 32
    normalize_embeddings: true
    dimension: 384

# ========== å‘é‡æ•°æ®åº“é…ç½® ==========
qdrant:
  host: "localhost"
  port: 6333
  grpc_port: 6334
  api_key: null  # é€šè¿‡ç¯å¢ƒå˜é‡ HIVEMEMORY__QDRANT__API_KEY è®¾ç½®
  collection_name: "hivememory_main"
  vector_dimension: 1024
  distance_metric: "Cosine"
  on_disk_payload: false

# ========== Redis é…ç½® ==========
redis:
  host: "localhost"
  port: 6379
  password: null  # é€šè¿‡ç¯å¢ƒå˜é‡ HIVEMEMORY__REDIS__PASSWORD è®¾ç½®
  db: 0
  decode_responses: true

# ========== æ„ŸçŸ¥å±‚é…ç½® ==========
perception:
  layer_type: "semantic_flow"  # å¯é€‰: semantic_flow, simple
  enable: true

  semantic_flow:
    idle_timeout_seconds: 900  # 15åˆ†é’Ÿ
    scan_interval_seconds: 30
    semantic_threshold: 0.6
    short_text_threshold: 50
    ema_alpha: 0.3
    max_processing_tokens: 8192
    enable_smart_summary: false

  simple:
    message_threshold: 6
    timeout_seconds: 900
    enable_semantic_trigger: true

# ========== è®°å¿†ç”Ÿæˆé…ç½® ==========
generation:
  extractor:
    max_retries: 2
    temperature: null  # null åˆ™ä½¿ç”¨ LLM é»˜è®¤å€¼
    max_tokens: null
    system_prompt: null
    user_prompt: null
    llm_config: null  # ä½¿ç”¨å…¨å±€ librarian é…ç½®

  gater:
    gater_type: "rule"  # rule/llm/hybrid
    min_total_length: 20
    min_substantive_length: 10
    trivial_patterns: []
    valuable_patterns: []
    llm_config: null

  deduplicator:
    high_similarity_threshold: 0.95  # TOUCH/UPDATE åˆ†ç•Œ
    low_similarity_threshold: 0.75   # UPDATE/CREATE åˆ†ç•Œ
    content_similarity_threshold: 0.9
    enable_vitality_tracking: true

# ========== è®°å¿†æ£€ç´¢é…ç½® ==========
retrieval:
  enable_routing: true

  router:
    router_type: "simple"  # simple/llm/always/never
    min_query_length: 3
    min_keyword_count: 1
    additional_keywords: []
    llm_config: null
    system_prompt: null

  processor:
    enable_time_parsing: true
    enable_type_detection: true
    enable_query_expansion: true
    expansion_keywords: []
    enable_llm_rewrite: false
    llm_config: null

  renderer:
    render_format: "xml"  # xml/markdown/plain
    max_tokens: 2000
    max_content_length: 500
    include_metadata: true
    include_confidence: true
    include_timestamp: true
    include_artifact: false
    title_template: "ğŸ“ {title}"
    confidence_threshold: 0.5
    old_memory_days: 90

  retriever:
    top_k: 5
    score_threshold: 0.75
    enable_hybrid_search: true
    enable_parallel: true

    dense:
      enabled: true
      top_k: 50
      score_threshold: 0.0
      enable_time_decay: true
      time_decay_days: 30
      enable_confidence_boost: true

    sparse:
      enabled: true
      top_k: 50
      score_threshold: 0.0

    fusion:
      rrf_k: 60
      dense_weight: 1.0
      sparse_weight: 1.0
      final_top_k: 5

    reranker:
      enabled: true
      type: "cross_encoder"  # noop æˆ– cross_encoder
      model_name: "BAAI/bge-reranker-v2-m3"
      device: "cpu"
      use_fp16: true
      batch_size: 32
      top_k: 20
      normalize_scores: true

# ========== è®°å¿†ç”Ÿå‘½å‘¨æœŸé…ç½® ==========
lifecycle:
  vitality_calculator:
    code_snippet_weight: 1.0
    fact_weight: 0.9
    url_resource_weight: 0.8
    reflection_weight: 0.7
    user_profile_weight: 0.6
    work_in_progress_weight: 0.5
    default_weight: 0.5
    max_access_boost: 20.0
    points_per_access: 2.0
    decay_lambda: 0.01

  reinforcement_engine:
    enable_event_history: true
    event_history_limit: 10000
    hit_boost: 5.0
    citation_boost: 20.0
    positive_feedback_boost: 50.0
    negative_feedback_penalty: -50.0
    negative_confidence_multiplier: 0.5

  archiver:
    archive_dir: "data/archived"
    compression: true

  garbage_collector:
    low_watermark: 20.0
    batch_size: 10
    enable_schedule: false
    interval_hours: 24

  high_watermark: 80.0
