# HiveMemory 环境配置示例
# 复制此文件为 .env 并填入实际值

# ======================
# LLM 配置 (LiteLLM)
# ======================

# Worker Agent LLM (用户可自定义)
WORKER_LLM_MODEL=gpt-4o
WORKER_LLM_API_KEY=your_openai_api_key_here
WORKER_LLM_API_BASE=https://api.openai.com/v1

# Librarian Agent (Patchouli) LLM (默认 DeepSeek)
LIBRARIAN_LLM_MODEL=deepseek/deepseek-chat
LIBRARIAN_LLM_API_KEY=your_deepseek_api_key_here
LIBRARIAN_LLM_API_BASE=https://api.deepseek.com

# ======================
# Embedding 配置
# ======================

# 使用本地 BGE-M3 模型
EMBEDDING_MODEL=BAAI/bge-m3
EMBEDDING_DEVICE=cpu  # 可选: cpu, cuda, mps
EMBEDDING_BATCH_SIZE=32

# ======================
# 数据库配置
# ======================

# Qdrant 向量数据库
QDRANT_HOST=localhost
QDRANT_PORT=6333
QDRANT_GRPC_PORT=6334
QDRANT_API_KEY=  # 本地部署无需填写
QDRANT_COLLECTION_NAME=hivememory_main

# Redis 配置
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=hivememory_redis_pass
REDIS_DB=0

# ======================
# 系统配置
# ======================

# 日志级别
LOG_LEVEL=INFO  # 可选: DEBUG, INFO, WARNING, ERROR

# 记忆缓冲区配置
BUFFER_MAX_MESSAGES=5
BUFFER_TIMEOUT_SECONDS=900  # 15分钟

# 向量维度
VECTOR_DIMENSION=1024

# ======================
# 检索配置 (Retrieval)
# ======================
# 注意：环境变量映射到 retrieval 子配置

# 顶层配置
RETRIEVAL_ENABLE_ROUTING=true  # 是否启用路由判断
RETRIEVAL_DEFAULT_TOP_K=5  # 默认返回数量
RETRIEVAL_DEFAULT_THRESHOLD=0.75  # 默认相似度阈值

# 路由器配置 (映射到 retrieval.router)
RETRIEVAL_ROUTER_TYPE=simple  # 路由器类型: simple/llm/always/never
RETRIEVAL_MIN_QUERY_LENGTH=3  # 查询最小长度
RETRIEVAL_MIN_KEYWORD_COUNT=1  # 最小关键词数量

# 查询处理器配置 (映射到 retrieval.processor)
RETRIEVAL_ENABLE_TIME_PARSING=true  # 是否启用时间表达式解析
RETRIEVAL_ENABLE_TYPE_DETECTION=true  # 是否启用记忆类型检测
RETRIEVAL_ENABLE_QUERY_EXPANSION=true  # 是否启用查询扩展
RETRIEVAL_ENABLE_LLM_REWRITE=false  # 是否启用 LLM 查询重写

# 渲染器配置 (映射到 retrieval.renderer)
RETRIEVAL_RENDER_FORMAT=xml  # 渲染格式: xml/markdown/plain
RETRIEVAL_MAX_TOKENS=2000  # 最大 Token 数
RETRIEVAL_MAX_CONTENT_LENGTH=500  # 单条记忆最大内容长度
RETRIEVAL_INCLUDE_METADATA=true  # 是否包含元数据
RETRIEVAL_INCLUDE_CONFIDENCE=true  # 是否包含置信度分数
RETRIEVAL_INCLUDE_TIMESTAMP=true  # 是否包含时间戳
RETRIEVAL_INCLUDE_ARTIFACT=false  # 是否包含记忆内容
RETRIEVAL_OLD_MEMORY_DAYS=90  # 记忆被视为陈旧的天数

# 混合搜索配置 (映射到 retrieval.hybrid_search)
# 顶层配置
RETRIEVAL_TOP_K=5  # 最终返回数量
RETRIEVAL_SCORE_THRESHOLD=0.75  # 相似度阈值
RETRIEVAL_ENABLE_HYBRID=true  # 是否启用混合检索
RETRIEVAL_ENABLE_PARALLEL=true  # 是否启用并行召回

# 稠密检索配置 (映射到 retrieval.hybrid_search.dense)
RETRIEVAL_DENSE_TOP_K=50  # RRF 融合前的召回数量
RETRIEVAL_DENSE_THRESHOLD=0.0  # 相似度阈值
RETRIEVAL_DENSE_ENABLE_TIME_DECAY=true  # 是否启用时间衰减
RETRIEVAL_DENSE_TIME_DECAY_DAYS=30  # 时间衰减天数
RETRIEVAL_DENSE_ENABLE_CONFIDENCE_BOOST=true  # 是否启用置信度加权

# 稀疏检索配置 (映射到 retrieval.hybrid_search.sparse)
RETRIEVAL_SPARSE_TOP_K=50  # RRF 融合前的召回数量
RETRIEVAL_SPARSE_THRESHOLD=0.0  # 相似度阈值

# 融合配置 (映射到 retrieval.hybrid_search.fusion)
RETRIEVAL_RRF_K=60  # RRF 常数
RETRIEVAL_DENSE_WEIGHT=1.0  # 稠密检索权重
RETRIEVAL_SPARSE_WEIGHT=1.0  # 稀疏检索权重
RETRIEVAL_FINAL_TOP_K=5  # 最终返回数量

# 重排序配置 (映射到 retrieval.hybrid_search.reranker)
RETRIEVAL_RERANKER_ENABLED=true  # 是否启用重排序
RETRIEVAL_RERANKER_MODEL=BAAI/bge-reranker-v2-m3  # Reranker 模型
RETRIEVAL_RERANKER_DEVICE=cpu  # 运行设备
RETRIEVAL_RERANKER_TOP_K=20  # 仅重排序前N个结果
RETRIEVAL_RERANKER_USE_FP16=true  # 是否使用 FP16 精度
RETRIEVAL_RERANKER_BATCH_SIZE=32  # 批处理大小
RETRIEVAL_RERANKER_NORMALIZE_SCORES=true  # 是否标准化分数

# ======================
# 感知层配置
# ======================
# 注意：环境变量映射到 perception.semantic_flow 或 perception.simple 子配置

# 感知层类型选择
PERCEPTION_LAYER_TYPE=semantic_flow  # 可选: semantic_flow, simple
PERCEPTION_ENABLE=true  # 是否启用感知层

# SemanticFlowPerceptionLayer 配置 (映射到 perception.semantic_flow)
PERCEPTION_IDLE_TIMEOUT=900  # 空闲超时时间（秒）
PERCEPTION_SCAN_INTERVAL=30  # 扫描间隔（秒）
PERCEPTION_SEMANTIC_THRESHOLD=0.6  # 语义相似度阈值
PERCEPTION_SHORT_TEXT_THRESHOLD=50  # 短文本强吸附阈值
PERCEPTION_EMA_ALPHA=0.3  # EMA 系数
PERCEPTION_MAX_TOKENS=8192  # 单次处理的最大 Token 数
PERCEPTION_ENABLE_SMART_SUMMARY=false  # 是否启用智能摘要

# 感知层 Embedding 配置（可选，覆盖全局配置）
# PERCEPTION_EMBEDDING_MODEL=sentence-transformers/all-MiniLM-L6-v2
# PERCEPTION_EMBEDDING_DEVICE=cpu
# PERCEPTION_EMBEDDING_CACHE_DIR=

# SimplePerceptionLayer 配置 (映射到 perception.simple)
PERCEPTION_SIMPLE_MESSAGE_THRESHOLD=6  # 消息数触发阈值
PERCEPTION_SIMPLE_TIMEOUT=900  # 超时时间（秒）
PERCEPTION_SIMPLE_SEMANTIC_TRIGGER=true  # 是否启用语义边界触发

# ======================
# 记忆提取配置 (Generation)
# ======================
# 注意：环境变量映射到 memory.extraction 子配置

# LLM 提取器配置 (映射到 memory.extraction.extractor)
EXTRACTION_MAX_RETRIES=2  # 最大重试次数
EXTRACTION_TEMPERATURE=0.3  # LLM 温度参数（覆盖全局）
EXTRACTION_MAX_TOKENS=8192  # LLM 最大 Token 数（覆盖全局）

# 价值评估器配置 (映射到 memory.extraction.gater)
GATER_TYPE=rule  # 评估器类型: rule/llm/hybrid
GATER_MIN_TOTAL_LENGTH=20  # 对话总长度最小值（字符数）
GATER_MIN_SUBSTANTIVE_LENGTH=10  # 实质内容最小长度

# 查重器配置 (映射到 memory.extraction.deduplicator)
DEDUPLICATOR_HIGH_THRESHOLD=0.95  # 高相似度阈值（TOUCH/UPDATE 分界）
DEDUPLICATOR_LOW_THRESHOLD=0.75  # 低相似度阈值（UPDATE/CREATE 分界）
DEDUPLICATOR_CONTENT_THRESHOLD=0.9  # 内容相似度阈值

# ======================
# 安全配置
# ======================

SECRET_KEY=your_secret_key_for_jwt_signing
ALLOWED_ORIGINS=http://localhost:3000,http://localhost:8501

# ======================
# 开发选项
# ======================

DEBUG_MODE=true
ENABLE_LOGGING=true
LOG_FILE_PATH=./logs/hivememory.log
